(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,a=window.wp.components,n=window.wp.i18n,r=window.wp.element,o=window.wp.data,c=window.wp.hooks,l=window.wp.compose,i=window.wp.date,s=e=>{if(!e)return"";const[t,a]=e.split(":");let n=parseInt(t);const r=n>=12?"PM":"AM";return n%=12,n=n||12,`${n}:${a} ${r}`};(0,e.registerBlockType)("evt/event-item",{title:(0,n.__)("Event Item","events"),icon:"calendar",category:"widgets",parent:["evt/events-grid"],providesContext:{"evt/eventDate":"eventDate","evt/eventStartTime":"eventStartTime","evt/eventEndTime":"eventEndTime"},attributes:{evtBlockId:{type:"string",default:""},eventImage:{type:"string",default:""},eventImageAlt:{type:"string",default:""},eventDate:{type:"string",default:(()=>{const e=new Date;return(0,i.dateI18n)("Y-m-d",e)})()},eventStartTime:{type:"string",default:"09:00"},eventEndTime:{type:"string",default:"17:00"},detailsBackgroundColor:{type:"string",default:"#ffffff"},isDefault:{type:"boolean",default:!1},hasImage:{type:"boolean",default:!1},mediaBlock:{type:"boolean",default:!1}},edit:({attributes:c,setAttributes:l,clientId:i})=>{const{evtBlockId:m,eventImage:v,eventImageAlt:d,eventDate:p,eventStartTime:u,eventEndTime:g,detailsBackgroundColor:k,isDefault:b,hasImage:E,mediaBlock:B}=c;(0,r.useEffect)(()=>{if(!m){const e=i.substring(0,8);l({evtBlockId:e})}},[]),(0,r.useEffect)(()=>{if(!m)return;const e=document.getElementById(`evt-block-style-${m}`);e&&e.remove();const t=document.createElement("style");return t.id=`evt-block-style-${m}`,t.innerHTML=`\n\t\t\t\t.evt-block-${m} .evt-event-details {\n\t\t\t\t\tbackground-color: ${k};\n\t\t\t\t}\n\t\t\t`,document.head.appendChild(t),()=>{const e=document.getElementById(`evt-block-style-${m}`);e&&e.remove()}},[m,k]);const f=(0,o.useSelect)(e=>{const t=e("core/block-editor").getBlock(i)?.innerBlocks||[];if(t.find(e=>"core/image"===e.name))return!0;const a=t.find(e=>"core/group"===e.name&&e.attributes?.className?.includes("evt-event-image-wrap"));return!!(a&&a.innerBlocks&&a.innerBlocks.find(e=>"core/image"===e.name))},[i]),h=t=>{if(t){const t=(0,e.createBlock)("core/group",{className:"evt-event-image-wrap"},[(0,e.createBlock)("core/image",{className:"evt-event-image-block"})]);(0,o.dispatch)("core/block-editor").insertBlocks(t,0,i),l({mediaBlock:!0,hasImage:!0}),setTimeout(()=>{const e=((0,o.select)("core/block-editor").getBlock(i)?.innerBlocks||[])[0];e&&e.innerBlocks&&e.innerBlocks[0]&&(0,o.dispatch)("core/block-editor").selectBlock(e.innerBlocks[0].clientId)},50)}else{const e=(0,o.select)("core/block-editor").getBlock(i)?.innerBlocks||[],t=e.find(e=>"core/group"===e.name&&e.attributes?.className?.includes("evt-event-image-wrap"));if(t)(0,o.dispatch)("core/block-editor").removeBlock(t.clientId);else{const t=e.find(e=>"core/image"===e.name);t&&(0,o.dispatch)("core/block-editor").removeBlock(t.clientId)}l({mediaBlock:!1,eventImage:"",eventImageAlt:"",hasImage:!1})}},T=(0,t.useBlockProps)({className:"evt-event-item"+(m?` evt-block-${m}`:"")}),w=[{title:"Crazy DJ Experience Santa Cruz",time:"9:00 AM - 5:00 PM",location:"JW Marriott, Sector 35",price:"$25.00"},{title:"Cute Girls Rock Band Performance",time:"9:00 AM - 5:00 PM",location:"Club XYZ, Sector 17",price:"$20.00"},{title:"Free Food Distribution At Mumbai",time:"9:00 AM - 5:00 PM",location:"Food Corp. Mumbai, Ft. Line",price:"No Cost"}],N=b?d.includes("DJ")?w[0]:d.includes("Rock")?w[1]:d.includes("Food")?w[2]:null:null,I=`${s(u)} – ${s(g)}`,y=b&&N?[["core/group",{className:"evt-event-image-wrap"},[["core/image",{url:v,alt:d,className:"evt-event-image-block"}]]],["core/group",{className:"evt-card-details"},[["evt/event-date-badge",{eventDate:p,isDateSet:!0}],["core/group",{className:"evt-event-detail"},[["core/paragraph",{className:"evt-event-time",content:I,evtStartTime:u,evtEndTime:g,evtIsTimeSet:!0}],["core/heading",{level:4,className:"evt-event-title",content:N?.title||""}],["core/paragraph",{placeholder:(0,n.__)("Event Description","events"),className:"evt-event-description"}],["core/paragraph",{className:"evt-event-location",content:N?.location||""}],["core/group",{className:"evt-price-read-more"},[["core/paragraph",{className:"evt-event-price",content:N?.price||""}],["core/buttons",{},[["core/button",{text:"Read More",className:"evt-event-read-more",url:""}]]]]]]]]]]:[["core/group",{className:"evt-event-image-wrap"},[["core/image",{className:"evt-event-image-block"}]]],["core/group",{className:"evt-card-details"},[["evt/event-date-badge",{eventDate:p,isDateSet:!0}],["core/group",{className:"evt-event-detail"},[["core/paragraph",{placeholder:(0,n.__)("9:00 AM – 5:00 PM","events"),className:"evt-event-time",evtStartTime:u,evtEndTime:g,evtIsTimeSet:!1}],["core/heading",{level:4,placeholder:(0,n.__)("Event Title","events"),className:"evt-event-title"}],["core/paragraph",{placeholder:(0,n.__)("Event Description","events"),className:"evt-event-description"}],["core/paragraph",{placeholder:(0,n.__)("Event Location","events"),className:"evt-event-location"}],["core/group",{className:"evt-price-read-more"},[["core/paragraph",{placeholder:(0,n.__)("Event Price","events"),className:"evt-event-price"}],["core/buttons",{},[["core/button",{text:(0,n.__)("Read More","events"),className:"evt-event-read-more",url:""}]]]]]]]]]];return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(t.InspectorControls,null,(0,r.createElement)(a.PanelBody,{title:(0,n.__)("Event Settings","events")},(0,r.createElement)(a.PanelRow,null,(0,r.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,r.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,n.__)("Details Background Color","events")),(0,r.createElement)(t.ColorPalette,{value:k,onChange:e=>l({detailsBackgroundColor:e||"#ffffff"})}))))),(0,r.createElement)("div",{...T},(0,r.createElement)("div",{className:"evt-event-card"},!f&&(0,r.createElement)("div",{className:"evt-add-image-block"},(0,r.createElement)(a.Button,{isSmall:!0,isSecondary:!0,onClick:()=>h(!0)},(0,n.__)("Add Image Block","events"))),f&&(0,r.createElement)("div",{className:"evt-add-image-block"},(0,r.createElement)(a.Button,{isSmall:!0,isSecondary:!0,onClick:()=>h(!1)},(0,n.__)("Remove Image Block","events"))),(0,r.createElement)("div",{className:"evt-event-details"},(0,r.createElement)("div",{className:"evt-event-details-inner"},(0,r.createElement)(t.InnerBlocks,{template:y,templateLock:!1,allowedBlocks:["core/group","core/image","evt/event-date-badge","core/heading","core/paragraph","core/list","core/buttons","core/button"],renderAppender:!1}))))))},save:({attributes:e})=>{const{evtBlockId:a}=e,n=t.useBlockProps.save({className:"evt-event-item"+(a?` evt-block-${a}`:"")});return(0,r.createElement)("div",{...n},(0,r.createElement)("div",{className:"evt-event-details"},(0,r.createElement)("div",{className:"evt-event-details-inner"},(0,r.createElement)(t.InnerBlocks.Content,null))))}}),(0,c.addFilter)("blocks.registerBlockType","evt/paragraph-time-attributes",(e,t)=>"core/paragraph"!==t?e:{...e,attributes:{...e.attributes,evtStartTime:{type:"string",default:"09:00"},evtEndTime:{type:"string",default:"17:00"},evtIsTimeSet:{type:"boolean",default:!1}}});const m=(0,l.createHigherOrderComponent)(e=>c=>{const{attributes:l,setAttributes:i,name:m}=c;if("core/paragraph"!==m||!l.className||!l.className.includes("evt-event-time"))return(0,r.createElement)(e,c);const{evtStartTime:v,evtEndTime:d,evtIsTimeSet:p}=l,u=(0,o.useSelect)(e=>{const{getBlockParents:t,getBlock:a}=e("core/block-editor"),n=t(c.clientId);for(let e of n){const t=a(e);if(t&&"evt/event-item"===t.name)return{clientId:e,startTime:t.attributes.eventStartTime||"09:00",endTime:t.attributes.eventEndTime||"17:00"}}return null},[c.clientId]),g=u?.startTime||v,k=u?.endTime||d,b=(e,t)=>{const a=`${s(e)} – ${s(t)}`;i({content:a})};return(0,r.useEffect)(()=>{u&&p&&b(g,k)},[u?.startTime,u?.endTime]),(0,r.createElement)(r.Fragment,{},(0,r.createElement)(e,c),(0,r.createElement)(t.InspectorControls,{},(0,r.createElement)(a.PanelBody,{title:(0,n.__)("Time Settings","events"),className:"evt-time-settings"},(0,r.createElement)("div",{className:"evt-start-time-input"},(0,r.createElement)("strong",{},(0,n.__)("Start Time","events")),(0,r.createElement)("input",{type:"time",value:g,onChange:e=>{return t=e.target.value,i({evtStartTime:t,evtIsTimeSet:!0}),u&&(0,o.dispatch)("core/block-editor").updateBlockAttributes(u.clientId,{eventStartTime:t}),void b(t,k);var t},onClick:e=>{e.target.showPicker&&e.target.showPicker()}})),(0,r.createElement)("div",{className:"evt-end-time-input"},(0,r.createElement)("strong",{},(0,n.__)("End Time","events")),(0,r.createElement)("input",{type:"time",value:k,onChange:e=>{return t=e.target.value,i({evtEndTime:t,evtIsTimeSet:!0}),u&&(0,o.dispatch)("core/block-editor").updateBlockAttributes(u.clientId,{eventEndTime:t}),void b(g,t);var t},onClick:e=>{e.target.showPicker&&e.target.showPicker()}})))))},"withTimeSettings");(0,c.addFilter)("editor.BlockEdit","evt/paragraph-time-settings",m)})();