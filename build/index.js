(()=>{"use strict";const e=window.React,t=window.wp.blocks,a=window.wp.blockEditor,n=window.wp.components,l=window.wp.i18n,o=window.wp.date,r=window.wp.element,c=window.wp.data,s=()=>{const e=new Date;return(0,o.dateI18n)("Y-m-d",e)};(0,t.registerBlockType)("evt/events-grid",{title:(0,l.__)("Events","events"),icon:"grid-view",category:"widgets",attributes:{columns:{type:"number",default:2}},edit:({attributes:t,setAttributes:o})=>{const{columns:r}=t,c=(0,a.useBlockProps)({className:"evt-events-grid-container",style:{"--grid-columns":r}}),s=window.evtPluginData&&window.evtPluginData.images?[window.evtPluginData.images.crazyDJ||"",window.evtPluginData.images.rockBand||"",window.evtPluginData.images.foodDistribution||""]:["","",""];return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.InspectorControls,null,(0,e.createElement)(n.PanelBody,{title:(0,l.__)("Grid Settings","events")},(0,e.createElement)(n.__experimentalNumberControl,{label:(0,l.__)("Columns","events"),value:r,onChange:e=>o({columns:parseInt(e)||2}),min:1,max:3,help:(0,l.__)("Number of columns in the grid (1-3)","evt")}))),(0,e.createElement)("div",{...c},(0,e.createElement)(a.InnerBlocks,{allowedBlocks:["evt/event-item"],template:[["evt/event-item",{eventImage:s[0],eventImageAlt:"Crazy DJ Experience Santa Cruz",eventDate:"2025-01-06",isDefault:!0,hasImage:!0}],["evt/event-item",{eventImage:s[1],eventImageAlt:"Cute Girls Rock Band Performance",eventDate:"2025-04-04",isDefault:!0,hasImage:!0}],["evt/event-item",{eventImage:s[2],eventImageAlt:"Free Food Distribution At Mumbai",eventDate:"2025-06-08",isDefault:!0,hasImage:!0}]],renderAppender:()=>(0,e.createElement)(a.InnerBlocks.ButtonBlockAppender,null)})))},save:({attributes:t})=>{const{columns:n}=t,l=a.useBlockProps.save({className:"evt-events-grid-container evt-front-view",style:{"--columns":n}});return(0,e.createElement)("div",{...l},(0,e.createElement)(a.InnerBlocks.Content,null))}}),(0,t.registerBlockType)("evt/event-date-badge",{title:(0,l.__)("Event Date","events"),icon:"clock",category:"widgets",parent:["evt/event-item"],usesContext:["evt/eventDate"],attributes:{eventDate:{type:"string",default:s()},dateBadgeBackgroundColor:{type:"string",default:"#2667FF"},dateBadgeTextColor:{type:"string",default:"#ffffff"},borderBadgeColor:{type:"string",default:"#00000040"},weekdayColor:{type:"string",default:"#000000"}},edit:({attributes:t,setAttributes:s,context:i,clientId:d})=>{const{eventDate:m,dateBadgeBackgroundColor:v,dateBadgeTextColor:u,borderBadgeColor:g,weekdayColor:p}=t,k=i["evt/eventDate"]||m,b=(0,c.useSelect)(e=>{const{getBlockParents:t,getBlock:a}=e("core/block-editor"),n=t(d);for(let e of n){const t=a(e);if(t&&"evt/event-item"===t.name)return e}return null},[d]);(0,r.useEffect)(()=>{i["evt/eventDate"]&&i["evt/eventDate"]!==m&&s({eventDate:i["evt/eventDate"]})},[i["evt/eventDate"]]);const B=(0,a.useBlockProps)({className:"evt-event-date-badge-container"}),y=(e=>{if(!e)return{day:"01",month:"Jan",weekday:"MON"};try{const t=new Date(e);return{day:(0,o.dateI18n)("d",t),month:(0,o.dateI18n)("M",t),weekday:(0,o.dateI18n)("D",t).toUpperCase()}}catch(e){return{day:"01",month:"Jan",weekday:"MON"}}})(k);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.InspectorControls,null,(0,e.createElement)(n.PanelBody,{title:(0,l.__)("Date Badge Settings","events")},(0,e.createElement)("div",{style:{marginBottom:"15px"}},(0,e.createElement)("strong",null,(0,l.__)("Event Date","events")),(0,e.createElement)(n.DateTimePicker,{currentDate:k,onChange:e=>{s({eventDate:e}),b&&(0,c.dispatch)("core/block-editor").updateBlockAttributes(b,{eventDate:e})},is12Hour:!0}))),(0,e.createElement)(n.PanelBody,{title:(0,l.__)("Date Colors","events"),initialOpen:!1},(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,l.__)("Background Color","events")),(0,e.createElement)(a.ColorPalette,{value:v,onChange:e=>s({dateBadgeBackgroundColor:e||"#2667FF"})}))),(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,l.__)("Text Color","events")),(0,e.createElement)(a.ColorPalette,{value:u,onChange:e=>s({dateBadgeTextColor:e||"#ffffff"})}))),(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,l.__)("Border Color","events")),(0,e.createElement)(a.ColorPalette,{value:g,onChange:e=>s({borderBadgeColor:e||"#00000040"})}))),(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,l.__)("Weekday Color","events")),(0,e.createElement)(a.ColorPalette,{value:p,onChange:e=>s({weekdayColor:e||"#000000"})}))))),(0,e.createElement)("div",{...B},(0,e.createElement)("div",{className:"evt-border-badge",style:{borderColor:g}},(0,e.createElement)("div",{className:"evt-event-date-badge",style:{backgroundColor:v,color:u}},(0,e.createElement)("span",{className:"evt-date-day"},y.day),(0,e.createElement)("span",{className:"evt-date-month"},y.month))),(0,e.createElement)("span",{className:"evt-date-weekday",style:{color:p}},y.weekday)))},save:({attributes:t})=>{const{eventDate:n,dateBadgeBackgroundColor:l,dateBadgeTextColor:r,borderBadgeColor:c,weekdayColor:s}=t,i=a.useBlockProps.save({className:"evt-event-date-badge-container"}),d=(e=>{if(!e)return{day:"01",month:"Jan",weekday:"MON"};try{const t=new Date(e);return{day:(0,o.dateI18n)("d",t),month:(0,o.dateI18n)("M",t),weekday:(0,o.dateI18n)("D",t).toUpperCase()}}catch(e){return{day:"01",month:"Jan",weekday:"MON"}}})(n);return(0,e.createElement)("div",{...i},(0,e.createElement)("div",{className:"evt-border-badge",style:{borderColor:c}},(0,e.createElement)("div",{className:"evt-event-date-badge",style:{backgroundColor:l,color:r}},(0,e.createElement)("span",{className:"evt-date-day"},d.day),(0,e.createElement)("span",{className:"evt-date-month"},d.month))),(0,e.createElement)("span",{className:"evt-date-weekday",style:{color:s}},d.weekday))}}),(0,t.registerBlockType)("evt/event-item",{title:(0,l.__)("Event Item","events"),icon:"calendar",category:"widgets",parent:["evt/events-grid"],providesContext:{"evt/eventDate":"eventDate"},attributes:{eventImage:{type:"string",default:""},eventImageAlt:{type:"string",default:""},eventDate:{type:"string",default:s()},detailsBackgroundColor:{type:"string",default:"#ffffff"},isDefault:{type:"boolean",default:!1},hasImage:{type:"boolean",default:!1},mediaBlock:{type:"boolean",default:!1}},edit:({attributes:s,setAttributes:i,clientId:d})=>{const{eventImage:m,eventImageAlt:v,eventDate:u,detailsBackgroundColor:g,isDefault:p,hasImage:k,mediaBlock:b}=s,{innerBlocks:B,hasImageBlock:y}=(0,c.useSelect)(e=>{const t=e("core/block-editor").getBlock(d)?.innerBlocks||[];let a=t.find(e=>"core/image"===e.name);if(!a){const e=t.find(e=>"core/group"===e.name&&e.attributes?.className?.includes("evt-event-image-wrap"));e&&e.innerBlocks&&(a=e.innerBlocks.find(e=>"core/image"===e.name))}return{innerBlocks:t,hasImageBlock:!!a}},[d]);let E=B.find(e=>"core/image"===e.name);if(!E){const e=B.find(e=>"core/group"===e.name&&e.attributes?.className?.includes("evt-event-image-wrap"));e&&e.innerBlocks&&(E=e.innerBlocks.find(e=>"core/image"===e.name))}(0,r.useEffect)(()=>{E?.attributes?.url&&E.attributes.url!==m&&i({eventImage:E.attributes.url,eventImageAlt:E.attributes.alt||v})},[E?.attributes?.url,E?.attributes?.alt]);const w=e=>{const a=(0,c.select)("core/block-editor").getBlock(d)?.innerBlocks||[],n=a.findIndex(e=>"core/group"===e.name&&e.attributes?.className?.includes("evt-event-image-wrap")),l=a.findIndex(e=>"core/image"===e.name);if(e){if(e&&-1===n&&-1===l){const e=(0,t.createBlock)("core/group",{className:"evt-event-image-wrap"},[(0,t.createBlock)("core/image",{url:m||"",alt:v||"",className:"evt-event-image-block"})]);(0,c.dispatch)("core/block-editor").insertBlocks(e,0,d),i({mediaBlock:!0,hasImage:!0}),setTimeout(()=>{const e=(0,c.select)("core/block-editor").getBlock(d)?.innerBlocks[0];e&&e.innerBlocks&&e.innerBlocks[0]&&(0,c.dispatch)("core/block-editor").selectBlock(e.innerBlocks[0].clientId)},50)}}else-1!==n?((0,c.dispatch)("core/block-editor").removeBlock(a[n].clientId,!0),i({mediaBlock:!1,eventImage:"",eventImageAlt:"",hasImage:!1})):-1!==l&&((0,c.dispatch)("core/block-editor").removeBlock(a[l].clientId,!0),i({mediaBlock:!1,eventImage:"",eventImageAlt:"",hasImage:!1}))},f=(0,a.useBlockProps)({className:"evt-event-item"}),h=((e=>{if(!e)return{day:"01",month:"Jan",weekday:"MON"};try{const t=new Date(e);return{day:(0,o.dateI18n)("d",t),month:(0,o.dateI18n)("M",t),weekday:(0,o.dateI18n)("D",t).toUpperCase()}}catch(e){return{day:"01",month:"Jan",weekday:"MON"}}})(u),[{title:"Crazy DJ Experience Santa Cruz",time:"9:00 AM - 5:00 PM",location:"JW Marriott, Sector 35",price:"$25.00"},{title:"Cute Girls Rock Band Performance",time:"9:00 AM - 5:00 PM",location:"Club XYZ, Sector 17",price:"$20.00"},{title:"Free Food Distribution At Mumbai",time:"9:00 AM - 5:00 PM",location:"Food Corp. Mumbai, Ft. Line",price:"No Cost"}]),C=p?v.includes("DJ")?h[0]:v.includes("Rock")?h[1]:v.includes("Food")?h[2]:null:null,N=p&&C?[["core/group",{className:"evt-event-image-wrap"},[["core/image",{url:m,alt:v,className:"evt-event-image-block"}]]],["core/group",{className:"evt-card-details"},[["evt/event-date-badge",{eventDate:u}],["core/group",{className:"evt-event-detail"},[["core/paragraph",{className:"evt-event-time",content:C?.time||""}],["core/heading",{level:4,className:"evt-event-title",content:C?.title||""}],["core/paragraph",{placeholder:(0,l.__)("Event Description","events"),className:"evt-event-description"}],["core/paragraph",{className:"evt-event-location",content:C?.location||""}],["core/group",{className:"evt-price-read-more"},[["core/paragraph",{className:"evt-event-price",content:C?.price||""}],["core/buttons",{},[["core/button",{text:"Read More",className:"evt-event-read-more",url:"#"}]]]]]]]]]]:[["core/group",{className:"evt-card-details"},[["evt/event-date-badge",{eventDate:u}],["core/group",{className:"evt-event-detail"},[["core/paragraph",{placeholder:(0,l.__)("9:00 AM - 5:00 PM","events"),className:"evt-event-time"}],["core/heading",{level:4,placeholder:(0,l.__)("Event Title","events"),className:"evt-event-title"}],["core/paragraph",{placeholder:(0,l.__)("Event Description","events"),className:"evt-event-description"}],["core/paragraph",{placeholder:(0,l.__)("Event Location","events"),className:"evt-event-location"}],["core/group",{className:"evt-price-read-more"},[["core/paragraph",{placeholder:(0,l.__)("Event Price","events"),className:"evt-event-price"}],["core/buttons",{},[["core/button",{text:(0,l.__)("Read More","events"),className:"evt-event-read-more",backgroundColor:"vivid-cyan-blue",url:"#"}]]]]]]]]]];return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.InspectorControls,null,(0,e.createElement)(n.PanelBody,{title:(0,l.__)("Event Settings","events")},(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,l.__)("Details Background Color","events")),(0,e.createElement)(a.ColorPalette,{value:g,onChange:e=>i({detailsBackgroundColor:e||"#ffffff"})}))))),(0,e.createElement)("div",{...f},(0,e.createElement)("div",{className:"evt-event-card"},!y&&(0,e.createElement)("div",{className:"evt-add-image-block"},(0,e.createElement)(n.Button,{isSmall:!0,isSecondary:!0,onClick:()=>w(!0)},(0,l.__)("Add Image Block","events"))),y&&(0,e.createElement)("div",{className:"evt-add-image-block"},(0,e.createElement)(n.Button,{isSmall:!0,isSecondary:!0,onClick:()=>w(!1)},(0,l.__)("Remove Image Block","events"))),(0,e.createElement)("div",{className:"evt-event-details",style:{backgroundColor:g}},(0,e.createElement)("div",{className:"evt-event-details-inner"},(0,e.createElement)(a.InnerBlocks,{template:N,templateLock:!1,allowedBlocks:["core/group","core/image","evt/event-date-badge","core/heading","core/paragraph","core/list","core/buttons","core/button"]}))))))},save:({attributes:t})=>{const{detailsBackgroundColor:n}=t,l=a.useBlockProps.save({className:"evt-event-item"});return(0,e.createElement)("div",{...l},(0,e.createElement)("div",{className:"evt-event-card"},(0,e.createElement)("div",{className:"evt-event-details",style:{backgroundColor:n}},(0,e.createElement)("div",{className:"evt-event-details-inner"},(0,e.createElement)(a.InnerBlocks.Content,null)))))}})})();