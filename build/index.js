(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,a=window.wp.components,n=window.wp.i18n,s=window.wp.date,r=()=>{const e=new Date;return(0,s.dateI18n)("Y-m-d",e)},o=e=>{if(!e)return"";const[t,a]=e.split(":");let n=parseInt(t);const s=n>=12?"PM":"AM";return n%=12,n=n||12,`${n}:${a} ${s}`},i=JSON.parse('{"UU":"evtb/events-grid"}'),l=window.ReactJSXRuntime;(0,e.registerBlockType)(i.UU,{edit:({attributes:e,setAttributes:s})=>{const{columns:r,hideYear:o,hidePastEvents:i}=e,c=(0,t.useBlockProps)({className:"evtb-events-grid-container",style:{"--grid-columns":r}});return window.evtbPluginData&&window.evtbPluginData.images&&(window.evtbPluginData.images.crazyDJ,window.evtbPluginData.images.rockBand,window.evtbPluginData.images.foodDistribution),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.InspectorControls,{children:(0,l.jsxs)(a.PanelBody,{title:(0,n.__)("Grid Settings","events"),children:[(0,l.jsx)(a.__experimentalNumberControl,{label:(0,n.__)("Columns","events"),value:r,onChange:e=>s({columns:parseInt(e)||2}),min:1,max:3,help:(0,n.__)("Number of columns in the grid (1-3)","evtb"),__next40pxDefaultSize:!0}),(0,l.jsx)(a.ToggleControl,{label:(0,n.__)("Hide Year (All Events)","events"),checked:o,onChange:e=>s({hideYear:e}),help:(0,n.__)("Toggle to hide or show the year in all event date badges","events"),__nextHasNoMarginBottom:!0}),(0,l.jsx)(a.ToggleControl,{label:(0,n.__)("Hide Past Events","events"),checked:i,onChange:e=>s({hidePastEvents:e}),help:(0,n.__)("Automatically hide events that have passed","events"),__nextHasNoMarginBottom:!0})]})}),(0,l.jsx)("div",{...c,children:(0,l.jsx)(t.InnerBlocks,{allowedBlocks:["evtb/event-item"],template:[["evtb/event-item",{eventImage:"",eventImageAlt:"",eventDate:"",isDefault:!1,hasImage:!1}]],renderAppender:()=>(0,l.jsx)(t.InnerBlocks.ButtonBlockAppender,{})})})]})},save:({attributes:e})=>{const{columns:a}=e,n=t.useBlockProps.save({className:"evtb-events-grid-container evtb-front-view",style:{"--columns":a}});return(0,l.jsx)("div",{...n,children:(0,l.jsx)(t.InnerBlocks.Content,{})})}});const c=window.wp.element,d=window.wp.data,v=window.wp.hooks,m=window.wp.compose,b={name:"evtb/event-item",title:"Event Item",category:"widgets",icon:"plus",description:"Individual event card with details.",keywords:["event","card","item"],textdomain:"events-block",parent:["evtb/events-grid"],attributes:{evtbBlockId:{type:"string",default:""},eventImage:{type:"string",default:""},eventImageAlt:{type:"string",default:""},eventDate:{type:"string",default:""},eventStartTime:{type:"string",default:"09:00"},eventEndTime:{type:"string",default:"17:00"},detailsBackgroundColor:{type:"string",default:"#ffffff"},isDefault:{type:"boolean",default:!1},hasImage:{type:"boolean",default:!1},mediaBlock:{type:"boolean",default:!1}},providesContext:{"evtb/eventDate":"eventDate","evtb/eventStartTime":"eventStartTime","evtb/eventEndTime":"eventEndTime"},usesContext:["evtb/hidePastEvents"],supports:{html:!1,reusable:!1,color:{background:!0,text:!1}}};(0,e.registerBlockType)(b.name,{...b,edit:({attributes:s,setAttributes:i,clientId:v,context:m})=>{const{evtbBlockId:b,eventImage:g,eventImageAlt:p,eventDate:u,eventStartTime:h,eventEndTime:k,detailsBackgroundColor:x,isDefault:f,hasImage:y,mediaBlock:B}=s;(0,c.useEffect)(()=>{if(!b){const e=v.substring(0,8);i({evtbBlockId:e})}},[]),(0,c.useEffect)(()=>{u||f||i({eventDate:r()})},[]);const w=(0,d.useSelect)(e=>{const t=e("core/block-editor").getBlock(v)?.innerBlocks||[];if(t.find(e=>"core/image"===e.name))return!0;const a=t.find(e=>"core/group"===e.name&&e.attributes?.className?.includes("evtb-event-image-wrap"));return!!(a&&a.innerBlocks&&a.innerBlocks.find(e=>"core/image"===e.name))},[v]),j=t=>{if(t){const t=(0,e.createBlock)("core/group",{className:"evtb-event-image-wrap"},[(0,e.createBlock)("core/image",{className:"evtb-event-image-block"})]);(0,d.dispatch)("core/block-editor").insertBlocks(t,0,v),i({mediaBlock:!0,hasImage:!0}),setTimeout(()=>{const e=((0,d.select)("core/block-editor").getBlock(v)?.innerBlocks||[])[0];e&&e.innerBlocks&&e.innerBlocks[0]&&(0,d.dispatch)("core/block-editor").selectBlock(e.innerBlocks[0].clientId)},50)}else{const e=(0,d.select)("core/block-editor").getBlock(v)?.innerBlocks||[],t=e.find(e=>"core/group"===e.name&&e.attributes?.className?.includes("evtb-event-image-wrap"));if(t)(0,d.dispatch)("core/block-editor").removeBlock(t.clientId);else{const t=e.find(e=>"core/image"===e.name);t&&(0,d.dispatch)("core/block-editor").removeBlock(t.clientId)}i({mediaBlock:!1,eventImage:"",eventImageAlt:"",hasImage:!1})}};let N=!1;if(m["evtb/hidePastEvents"]&&u)try{const e=new Date;let t=new Date(u);if(k){const[e,a]=k.split(":");t.setHours(e,a),h&&k<h&&t.setDate(t.getDate()+1)}else t.setHours(23,59,59);t<e&&(N=!0)}catch(e){}const _=(0,t.useBlockProps)({className:"evtb-event-item"+(b?` evtb-block-${b}`:""),style:N?{opacity:.6,filter:"grayscale(1)"}:{}}),C=[{title:"Crazy DJ Experience Santa Cruz",time:"9:00 AM - 5:00 PM",location:"JW Marriott, Sector 35",price:"$25.00"},{title:"Cute Girls Rock Band Performance",time:"9:00 AM - 5:00 PM",location:"Club XYZ, Sector 17",price:"$20.00"},{title:"Free Food Distribution At Mumbai",time:"9:00 AM - 5:00 PM",location:"Food Corp. Mumbai, Ft. Line",price:"No Cost"}],I=f?p.includes("DJ")?C[0]:p.includes("Rock")?C[1]:p.includes("Food")?C[2]:null:null,T=`${o(h)} – ${o(k)}`,D=f&&I?[["core/group",{className:"evtb-event-image-wrap"},[["core/image",{url:g,alt:p,className:"evtb-event-image-block"}]]],["core/group",{className:"evtb-card-details"},[["evtb/event-date-badge",{eventDate:u,isDateSet:!0}],["core/group",{className:"evtb-event-detail"},[["core/paragraph",{className:"evtb-event-time",content:T,evtbStartTime:h,evtbEndTime:k,evtbIsTimeSet:!0}],["core/heading",{level:4,className:"evtb-event-title",content:I?.title||""}],["core/paragraph",{placeholder:(0,n.__)("Event Description","events"),className:"evtb-event-description"}],["core/paragraph",{className:"evtb-event-location",content:I?.location||""}],["core/group",{className:"evtb-price-read-more"},[["core/paragraph",{className:"evtb-event-price",content:I?.price||""}],["core/buttons",{},[["core/button",{text:"Read More",className:"evtb-event-read-more",url:""}]]]]]]]]]]:[["core/group",{className:"evtb-event-image-wrap"},[["core/image",{className:"evtb-event-image-block"}]]],["core/group",{className:"evtb-card-details"},[["evtb/event-date-badge",{eventDate:u,isDateSet:!0}],["core/group",{className:"evtb-event-detail"},[["core/paragraph",{placeholder:(0,n.__)("9:00 AM – 5:00 PM","events"),className:"evtb-event-time",evtbStartTime:h,evtbEndTime:k,evtbIsTimeSet:!1}],["core/heading",{level:4,placeholder:(0,n.__)("Event Title","events"),className:"evtb-event-title"}],["core/paragraph",{placeholder:(0,n.__)("Event Description","events"),className:"evtb-event-description"}],["core/paragraph",{placeholder:(0,n.__)("Event Location","events"),className:"evtb-event-location"}],["core/group",{className:"evtb-price-read-more"},[["core/paragraph",{placeholder:(0,n.__)("Event Price","events"),className:"evtb-event-price"}],["core/buttons",{},[["core/button",{text:(0,n.__)("Read More","events"),className:"evtb-event-read-more",url:""}]]]]]]]]]];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.InspectorControls,{children:(0,l.jsx)(a.PanelBody,{title:(0,n.__)("Event Settings","events"),children:(0,l.jsx)(a.PanelRow,{children:(0,l.jsxs)("div",{style:{width:"100%",marginTop:"16px"},children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:(0,n.__)("Details Background Color","events")}),(0,l.jsx)(t.ColorPalette,{value:x,onChange:e=>i({detailsBackgroundColor:e||"#ffffff"})})]})})})}),(0,l.jsx)("div",{..._,children:(0,l.jsxs)("div",{className:"evtb-event-card",children:[!w&&(0,l.jsx)("div",{className:"evtb-add-image-block",children:(0,l.jsx)(a.Button,{isSmall:!0,isSecondary:!0,onClick:()=>j(!0),children:(0,n.__)("Add Image Block","events")})}),w&&(0,l.jsx)("div",{className:"evtb-add-image-block",children:(0,l.jsx)(a.Button,{isSmall:!0,isSecondary:!0,onClick:()=>j(!1),children:(0,n.__)("Remove Image Block","events")})}),(0,l.jsx)("div",{className:"evtb-event-details",style:{"--evtb-details-bg":x||"#ffffff"},children:(0,l.jsx)("div",{className:"evtb-event-details-inner",children:(0,l.jsx)(t.InnerBlocks,{template:D,templateLock:!1,allowedBlocks:["core/group","core/image","evtb/event-date-badge","core/heading","core/paragraph","core/list","core/buttons","core/button"],renderAppender:!1})})})]})})]})},save:({attributes:e})=>{const{evtbBlockId:a,detailsBackgroundColor:n}=e,s=t.useBlockProps.save({className:"evtb-event-item"+(a?` evtb-block-${a}`:""),style:{"--evtb-details-bg":n||"#ffffff"}});return(0,l.jsx)("div",{...s,children:(0,l.jsx)("div",{className:"evtb-event-card",children:(0,l.jsx)("div",{className:"evtb-event-details",children:(0,l.jsx)("div",{className:"evtb-event-details-inner",children:(0,l.jsx)(t.InnerBlocks.Content,{})})})})})}}),(0,v.addFilter)("blocks.registerBlockType","evtb/paragraph-time-attributes",(e,t)=>"core/paragraph"!==t?e:{...e,attributes:{...e.attributes,evtbStartTime:{type:"string",default:"09:00"},evtbEndTime:{type:"string",default:"17:00"},evtbIsTimeSet:{type:"boolean",default:!1}}});const g=(0,m.createHigherOrderComponent)(e=>s=>{const{attributes:r,setAttributes:i,name:l}=s;if("core/paragraph"!==l||!r.className||!r.className.includes("evtb-event-time"))return(0,c.createElement)(e,s);const{evtbStartTime:v,evtbEndTime:m,evtbIsTimeSet:b}=r,g=(0,d.useSelect)(e=>{const{getBlockParents:t,getBlock:a}=e("core/block-editor"),n=t(s.clientId);for(let e of n){const t=a(e);if(t&&"evtb/event-item"===t.name)return{clientId:e,startTime:t.attributes.eventStartTime||"09:00",endTime:t.attributes.eventEndTime||"17:00"}}return null},[s.clientId]),p=g?.startTime||v,u=g?.endTime||m,h=(e,t)=>{const a=`${o(e)} – ${o(t)}`;i({content:a})};return(0,c.useEffect)(()=>{g&&b&&h(p,u)},[g?.startTime,g?.endTime]),(0,c.createElement)(c.Fragment,{},(0,c.createElement)(e,s),(0,c.createElement)(t.InspectorControls,{},(0,c.createElement)(a.PanelBody,{title:(0,n.__)("Time Settings","events"),className:"evtb-time-settings"},(0,c.createElement)("div",{className:"evtb-start-time-input"},(0,c.createElement)("strong",{},(0,n.__)("Start Time","events")),(0,c.createElement)("input",{type:"time",value:p,onChange:e=>{return t=e.target.value,i({evtbStartTime:t,evtbIsTimeSet:!0}),g&&(0,d.dispatch)("core/block-editor").updateBlockAttributes(g.clientId,{eventStartTime:t}),void h(t,u);var t},onClick:e=>{e.target.showPicker&&e.target.showPicker()}})),(0,c.createElement)("div",{className:"evtb-end-time-input"},(0,c.createElement)("strong",{},(0,n.__)("End Time","events")),(0,c.createElement)("input",{type:"time",value:u,onChange:e=>{return t=e.target.value,i({evtbEndTime:t,evtbIsTimeSet:!0}),g&&(0,d.dispatch)("core/block-editor").updateBlockAttributes(g.clientId,{eventEndTime:t}),void h(p,t);var t},onClick:e=>{e.target.showPicker&&e.target.showPicker()}})))))},"withTimeSettings");(0,v.addFilter)("editor.BlockEdit","evtb/paragraph-time-settings",g);const p=JSON.parse('{"UU":"evtb/event-date-badge"}');(0,e.registerBlockType)(p.UU,{edit:({attributes:e,setAttributes:o,context:i,clientId:v})=>{const{evtbBadgeId:m,eventDate:b,isDateSet:g,dateBadgeBackgroundColor:p,dateBadgeTextColor:u,borderBadgeColor:h,weekdayColor:k,hideYear:x}=e;(0,c.useEffect)(()=>{if(!m){const e=v.substring(0,8);o({evtbBadgeId:e})}},[]),(0,c.useEffect)(()=>{b||i["evtb/eventDate"]||o({eventDate:r()})},[]);const f=i["evtb/eventDate"]||b||r(),y=(0,d.useSelect)(e=>{const{getBlockParents:t,getBlock:a}=e("core/block-editor"),n=t(v);for(let e of n){const t=a(e);if(t&&"evtb/event-item"===t.name)return e}return null},[v]);(0,c.useEffect)(()=>{i["evtb/eventDate"]&&i["evtb/eventDate"]!==b&&o({eventDate:i["evtb/eventDate"]})},[i["evtb/eventDate"]]),(0,c.useEffect)(()=>{void 0!==i["evtb/hideYear"]&&i["evtb/hideYear"]!==x&&o({hideYear:i["evtb/hideYear"]})},[i["evtb/hideYear"]]);const B=(0,t.useBlockProps)({className:"evtb-event-date-badge-container"+(m?` evtb-badge-${m}`:""),style:{"--evtb-badge-bg":p,"--evtb-badge-text":u,"--evtb-badge-border":h,"--evtb-badge-weekday":k}}),w=(e=>{if(!e)return{day:"01",month:"Jan",year:"0001",weekday:"MON"};try{const t=new Date(e);return{day:(0,s.dateI18n)("d",t),month:(0,s.dateI18n)("M",t),year:(0,s.dateI18n)("Y",t),weekday:(0,s.dateI18n)("D",t).toUpperCase()}}catch(e){return{day:"01",month:"Jan",year:"0001",weekday:"MON"}}})(f);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(t.InspectorControls,{children:[(0,l.jsx)(a.PanelBody,{className:"evtb-date-settings",title:(0,n.__)("Date Settings","events"),children:(0,l.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,l.jsx)("strong",{children:(0,n.__)("Event Date","events")}),(0,l.jsx)("div",{style:{margin:"10px 0"},children:(0,l.jsx)(a.ToggleControl,{label:(0,n.__)("Hide Year","events"),checked:x,onChange:e=>o({hideYear:e}),help:(0,n.__)("Toggle to hide or show the year in the date badge","events"),__nextHasNoMarginBottom:!0})}),(0,l.jsx)(a.DateTimePicker,{currentDate:f,onChange:e=>{o({eventDate:e,isDateSet:!0}),y&&(0,d.dispatch)("core/block-editor").updateBlockAttributes(y,{eventDate:e})},is12Hour:!0})]})}),(0,l.jsxs)(a.PanelBody,{title:(0,n.__)("Date Colors","events"),initialOpen:!1,children:[(0,l.jsx)(a.PanelRow,{children:(0,l.jsxs)("div",{style:{width:"100%",marginTop:"16px"},children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:(0,n.__)("Background Color","events")}),(0,l.jsx)(t.ColorPalette,{value:p,onChange:e=>o({dateBadgeBackgroundColor:e||"#2667FF"})})]})}),(0,l.jsx)(a.PanelRow,{children:(0,l.jsxs)("div",{style:{width:"100%",marginTop:"16px"},children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:(0,n.__)("Text Color","events")}),(0,l.jsx)(t.ColorPalette,{value:u,onChange:e=>o({dateBadgeTextColor:e||"#ffffff"})})]})}),(0,l.jsx)(a.PanelRow,{children:(0,l.jsxs)("div",{style:{width:"100%",marginTop:"16px"},children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:(0,n.__)("Border Color","events")}),(0,l.jsx)(t.ColorPalette,{value:h,onChange:e=>o({borderBadgeColor:e||"#00000040"})})]})}),(0,l.jsx)(a.PanelRow,{children:(0,l.jsxs)("div",{style:{width:"100%",marginTop:"16px"},children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:(0,n.__)("Weekday Color","events")}),(0,l.jsx)(t.ColorPalette,{value:k,onChange:e=>o({weekdayColor:e||"#000000"})})]})})]})]}),(0,l.jsxs)("div",{...B,children:[(0,l.jsx)("div",{className:"evtb-border-badge",children:(0,l.jsxs)("div",{className:"evtb-event-date-badge",children:[(0,l.jsx)("span",{className:"evtb-date-day",children:w.day}),(0,l.jsx)("span",{className:"evtb-date-month",children:w.month}),!x&&"0001"!==w.year&&(0,l.jsx)("span",{className:"evtb-date-year",children:w.year})]})}),(0,l.jsx)("span",{className:"evtb-date-weekday",children:w.weekday})]})]})},save:({attributes:e})=>{const{evtbBadgeId:a,eventDate:n,isDateSet:r,dateBadgeBackgroundColor:o,dateBadgeTextColor:i,borderBadgeColor:c,weekdayColor:d,hideYear:v}=e,m=t.useBlockProps.save({className:"evtb-event-date-badge-container"+(a?` evtb-badge-${a}`:""),style:{"--evtb-badge-bg":o||"#2667FF","--evtb-badge-text":i||"#ffffff","--evtb-badge-border":c||"#00000040","--evtb-badge-weekday":d||"#000000"}}),b=(e=>{if(!e)return{day:"01",month:"Jan",year:"0001",weekday:"MON"};try{const t=new Date(e);return{day:(0,s.dateI18n)("d",t),month:(0,s.dateI18n)("M",t),year:(0,s.dateI18n)("Y",t),weekday:(0,s.dateI18n)("D",t).toUpperCase()}}catch(e){return{day:"01",month:"Jan",year:"0001",weekday:"MON"}}})(n);return(0,l.jsxs)("div",{...m,children:[(0,l.jsx)("div",{className:"evtb-border-badge",children:(0,l.jsxs)("div",{className:"evtb-event-date-badge",children:[(0,l.jsx)("span",{className:"evtb-date-day",children:b.day}),(0,l.jsx)("span",{className:"evtb-date-month",children:b.month}),!v&&(0,l.jsx)("span",{className:"evtb-date-year",children:b.year})]})}),(0,l.jsx)("span",{className:"evtb-date-weekday",children:b.weekday})]})}})})();