(()=>{"use strict";const e=window.React,t=window.wp.blocks,a=window.wp.blockEditor,n=window.wp.components,r=window.wp.i18n,l=window.wp.date,o=window.wp.element,c=window.wp.data,s=()=>{const e=new Date;return(0,l.dateI18n)("Y-m-d",e)},i=e=>{if(!e)return"";const[t,a]=e.split(":");let n=parseInt(t);const r=n>=12?"PM":"AM";return n%=12,n=n||12,`${n}:${a} ${r}`};(0,t.registerBlockType)("evt/events-grid",{title:(0,r.__)("Events","events"),icon:"grid-view",category:"widgets",attributes:{columns:{type:"number",default:2}},edit:({attributes:t,setAttributes:l})=>{const{columns:o}=t,c=(0,a.useBlockProps)({className:"evt-events-grid-container",style:{"--grid-columns":o}}),s=window.evtPluginData&&window.evtPluginData.images?[window.evtPluginData.images.crazyDJ||"",window.evtPluginData.images.rockBand||"",window.evtPluginData.images.foodDistribution||""]:["","",""];return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.InspectorControls,null,(0,e.createElement)(n.PanelBody,{title:(0,r.__)("Grid Settings","events")},(0,e.createElement)(n.__experimentalNumberControl,{label:(0,r.__)("Columns","events"),value:o,onChange:e=>l({columns:parseInt(e)||2}),min:1,max:3,help:(0,r.__)("Number of columns in the grid (1-3)","evt")}))),(0,e.createElement)("div",{...c},(0,e.createElement)(a.InnerBlocks,{allowedBlocks:["evt/event-item"],template:[["evt/event-item",{eventImage:s[0],eventImageAlt:"Crazy DJ Experience Santa Cruz",eventDate:"0001-01-06",isDefault:!0,hasImage:!0}],["evt/event-item",{eventImage:s[1],eventImageAlt:"Cute Girls Rock Band Performance",eventDate:"0001-04-04",isDefault:!0,hasImage:!0}],["evt/event-item",{eventImage:s[2],eventImageAlt:"Free Food Distribution At Mumbai",eventDate:"0001-06-08",isDefault:!0,hasImage:!0}]],renderAppender:()=>(0,e.createElement)(a.InnerBlocks.ButtonBlockAppender,null)})))},save:({attributes:t})=>{const{columns:n}=t,r=a.useBlockProps.save({className:"evt-events-grid-container evt-front-view",style:{"--columns":n}});return(0,e.createElement)("div",{...r},(0,e.createElement)(a.InnerBlocks.Content,null))}}),(0,t.registerBlockType)("evt/event-date-badge",{title:(0,r.__)("Event Date","events"),icon:"clock",category:"widgets",parent:["evt/event-item"],usesContext:["evt/eventDate","evt/eventStartTime","evt/eventEndTime"],attributes:{evtBadgeId:{type:"string",default:""},eventDate:{type:"string",default:s()},eventStartTime:{type:"string",default:"09:00"},eventEndTime:{type:"string",default:"17:00"},isDateSet:{type:"boolean",default:!1},hideYear:{type:"boolean",default:!1},dateBadgeBackgroundColor:{type:"string",default:"#2667FF"},dateBadgeTextColor:{type:"string",default:"#ffffff"},borderBadgeColor:{type:"string",default:"#00000040"},weekdayColor:{type:"string",default:"#000000"}},edit:({attributes:t,setAttributes:s,context:d,clientId:v})=>{const{evtBadgeId:m,eventDate:u,eventStartTime:g,eventEndTime:p,isDateSet:k,hideYear:b,dateBadgeBackgroundColor:y,dateBadgeTextColor:E,borderBadgeColor:f,weekdayColor:B}=t;(0,o.useEffect)(()=>{if(!m){const e=v.substring(0,8);s({evtBadgeId:e})}},[]);const h=d["evt/eventDate"]||u,w=d["evt/eventStartTime"]||g,I=d["evt/eventEndTime"]||p,N=(0,c.useSelect)(e=>{const{getBlockParents:t,getBlock:a}=e("core/block-editor"),n=t(v);for(let e of n){const t=a(e);if(t&&"evt/event-item"===t.name)return e}return null},[v]);(0,o.useEffect)(()=>{d["evt/eventDate"]&&d["evt/eventDate"]!==u&&s({eventDate:d["evt/eventDate"]}),d["evt/eventStartTime"]&&d["evt/eventStartTime"]!==g&&s({eventStartTime:d["evt/eventStartTime"]}),d["evt/eventEndTime"]&&d["evt/eventEndTime"]!==p&&s({eventEndTime:d["evt/eventEndTime"]})},[d["evt/eventDate"],d["evt/eventStartTime"],d["evt/eventEndTime"]]),(0,o.useEffect)(()=>{N&&w&&I&&_(w,I)},[N,w,I]),(0,o.useEffect)(()=>{if(!m)return;const e=document.getElementById(`evt-badge-style-${m}`);e&&e.remove();const t=document.createElement("style");return t.id=`evt-badge-style-${m}`,t.innerHTML=`\n\t\t\t\t.evt-badge-${m} .evt-border-badge {\n\t\t\t\t\tborder: 1px solid ${f};\n\t\t\t\t}\n\t\t\t\t.evt-badge-${m} .evt-event-date-badge {\n\t\t\t\t\tbackground-color: ${y};\n\t\t\t\t\tcolor: ${E};\n\t\t\t\t}\n\t\t\t\t.evt-badge-${m} .evt-date-day,\n\t\t\t\t.evt-badge-${m} .evt-date-month {\n\t\t\t\t\tcolor: ${E};\n\t\t\t\t}\n\t\t\t\t.evt-badge-${m} .evt-date-weekday {\n\t\t\t\t\tcolor: ${B};\n\t\t\t\t}\n\t\t\t`,document.head.appendChild(t),()=>{const e=document.getElementById(`evt-badge-style-${m}`);e&&e.remove()}},[m,y,E,f,B]);const C=(0,a.useBlockProps)({className:"evt-event-date-badge-container"+(m?` evt-badge-${m}`:"")}),D=(e=>{if(!e)return{day:"01",month:"Jan",year:"0001",weekday:"MON"};try{const t=new Date(e);return{day:(0,l.dateI18n)("d",t),month:(0,l.dateI18n)("M",t),year:(0,l.dateI18n)("Y",t),weekday:(0,l.dateI18n)("D",t).toUpperCase()}}catch(e){return{day:"01",month:"Jan",year:"0001",weekday:"MON"}}})(h),_=(e,t)=>{if(!N)return;const a=(0,c.select)("core/block-editor").getBlock(N);if(!a)return;const n=e=>{for(let t of e){if("core/paragraph"===t.name&&"evt-event-time"===t.attributes.className)return t.clientId;if(t.innerBlocks&&t.innerBlocks.length>0){const e=n(t.innerBlocks);if(e)return e}}return null},r=n(a.innerBlocks);if(r){const a=`${i(e)} – ${i(t)}`;(0,c.dispatch)("core/block-editor").updateBlockAttributes(r,{content:a})}};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.InspectorControls,null,(0,e.createElement)(n.PanelBody,{className:"evt-date-badge-settings",title:(0,r.__)("Date Badge Settings","events")},(0,e.createElement)("div",{style:{marginBottom:"15px"}},(0,e.createElement)("strong",null,(0,r.__)("Event Date","events")),(0,e.createElement)(n.DateTimePicker,{currentDate:h,onChange:e=>{s({eventDate:e,isDateSet:!0}),N&&(0,c.dispatch)("core/block-editor").updateBlockAttributes(N,{eventDate:e})},is12Hour:!0})),(0,e.createElement)("p",{style:{fontSize:"13px",color:"#FF0000",marginBottom:"10px"}},(0,r.__)("If you do not want to display the year, please remove the value from the year section.","events")),(0,e.createElement)("div",{style:{marginBottom:"15px"}},(0,e.createElement)("strong",null,(0,r.__)("Start Time","events")),(0,e.createElement)("input",{type:"time",value:w,onChange:e=>{return t=e.target.value,s({eventStartTime:t}),void(N&&((0,c.dispatch)("core/block-editor").updateBlockAttributes(N,{eventStartTime:t}),_(t,I)));var t},style:{width:"100%",padding:"8px",marginTop:"8px",border:"1px solid #ddd",borderRadius:"4px"}})),(0,e.createElement)("div",{style:{marginBottom:"15px"}},(0,e.createElement)("strong",null,(0,r.__)("End Time","events")),(0,e.createElement)("input",{type:"time",value:I,onChange:e=>{return t=e.target.value,s({eventEndTime:t}),void(N&&((0,c.dispatch)("core/block-editor").updateBlockAttributes(N,{eventEndTime:t}),_(w,t)));var t},style:{width:"100%",padding:"8px",marginTop:"8px",border:"1px solid #ddd",borderRadius:"4px"}}))),(0,e.createElement)(n.PanelBody,{title:(0,r.__)("Date Colors","events"),initialOpen:!1},(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,r.__)("Background Color","events")),(0,e.createElement)(a.ColorPalette,{value:y,onChange:e=>s({dateBadgeBackgroundColor:e||"#2667FF"})}))),(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,r.__)("Text Color","events")),(0,e.createElement)(a.ColorPalette,{value:E,onChange:e=>s({dateBadgeTextColor:e||"#ffffff"})}))),(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,r.__)("Border Color","events")),(0,e.createElement)(a.ColorPalette,{value:f,onChange:e=>s({borderBadgeColor:e||"#00000040"})}))),(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,r.__)("Weekday Color","events")),(0,e.createElement)(a.ColorPalette,{value:B,onChange:e=>s({weekdayColor:e||"#000000"})}))))),(0,e.createElement)("div",{...C},(0,e.createElement)("div",{className:"evt-border-badge"},(0,e.createElement)("div",{className:"evt-event-date-badge"},(0,e.createElement)("span",{className:"evt-date-day"},D.day),(0,e.createElement)("span",{className:"evt-date-month"},D.month),!b&&"0001"!==D.year&&(0,e.createElement)("span",{className:"evt-date-year"},D.year))),(0,e.createElement)("span",{className:"evt-date-weekday"},D.weekday)))},save:({attributes:t})=>{const{evtBadgeId:n,eventDate:r,isDateSet:o,hideYear:c}=t;if(!o)return null;const s=a.useBlockProps.save({className:"evt-event-date-badge-container"+(n?` evt-badge-${n}`:"")}),i=(e=>{if(!e)return{day:"01",month:"Jan",year:"0001",weekday:"MON"};try{const t=new Date(e);return{day:(0,l.dateI18n)("d",t),month:(0,l.dateI18n)("M",t),year:(0,l.dateI18n)("Y",t),weekday:(0,l.dateI18n)("D",t).toUpperCase()}}catch(e){return{day:"01",month:"Jan",year:"0001",weekday:"MON"}}})(r);return(0,e.createElement)("div",{...s},(0,e.createElement)("div",{className:"evt-border-badge"},(0,e.createElement)("div",{className:"evt-event-date-badge"},(0,e.createElement)("span",{className:"evt-date-day"},i.day),(0,e.createElement)("span",{className:"evt-date-month"},i.month),!c&&"0001"!==i.year&&(0,e.createElement)("span",{className:"evt-date-year"},i.year))),(0,e.createElement)("span",{className:"evt-date-weekday"},i.weekday))}}),(0,t.registerBlockType)("evt/event-item",{title:(0,r.__)("Event Item","events"),icon:"calendar",category:"widgets",parent:["evt/events-grid"],providesContext:{"evt/eventDate":"eventDate","evt/eventStartTime":"eventStartTime","evt/eventEndTime":"eventEndTime"},attributes:{evtBlockId:{type:"string",default:""},eventImage:{type:"string",default:""},eventImageAlt:{type:"string",default:""},eventDate:{type:"string",default:s()},eventStartTime:{type:"string",default:"09:00"},eventEndTime:{type:"string",default:"17:00"},detailsBackgroundColor:{type:"string",default:"#ffffff"},isDefault:{type:"boolean",default:!1},hasImage:{type:"boolean",default:!1},mediaBlock:{type:"boolean",default:!1}},edit:({attributes:l,setAttributes:s,clientId:d})=>{const{evtBlockId:v,eventImage:m,eventImageAlt:u,eventDate:g,eventStartTime:p,eventEndTime:k,detailsBackgroundColor:b,isDefault:y}=l;(0,o.useEffect)(()=>{if(!v){const e=d.substring(0,8);s({evtBlockId:e})}},[]),(0,o.useEffect)(()=>{if(!v)return;const e=document.getElementById(`evt-block-style-${v}`);e&&e.remove();const t=document.createElement("style");return t.id=`evt-block-style-${v}`,t.innerHTML=`\n\t\t\t\t.evt-block-${v} .evt-event-details {\n\t\t\t\t\tbackground-color: ${b};\n\t\t\t\t}\n\t\t\t`,document.head.appendChild(t),()=>{const e=document.getElementById(`evt-block-style-${v}`);e&&e.remove()}},[v,b]);const{innerBlocks:E,hasImageBlock:f}=(0,c.useSelect)(e=>{const t=e("core/block-editor").getBlock(d)?.innerBlocks||[];let a=t.find(e=>"core/image"===e.name);if(!a){const e=t.find(e=>"core/group"===e.name&&e.attributes?.className?.includes("evt-event-image-wrap"));e&&e.innerBlocks&&(a=e.innerBlocks.find(e=>"core/image"===e.name))}return{innerBlocks:t,hasImageBlock:!!a}},[d]);let B=E.find(e=>"core/image"===e.name);if(!B){const e=E.find(e=>"core/group"===e.name&&e.attributes?.className?.includes("evt-event-image-wrap"));e&&e.innerBlocks&&(B=e.innerBlocks.find(e=>"core/image"===e.name))}(0,o.useEffect)(()=>{B?.attributes?.url&&B.attributes.url!==m&&s({eventImage:B.attributes.url,eventImageAlt:B.attributes.alt||u})},[B?.attributes?.url,B?.attributes?.alt]);const h=e=>{const a=(0,c.select)("core/block-editor").getBlock(d)?.innerBlocks||[],n=a.findIndex(e=>"core/group"===e.name&&e.attributes?.className?.includes("evt-event-image-wrap")),r=a.findIndex(e=>"core/image"===e.name);if(e){if(e&&-1===n&&-1===r){const e=(0,t.createBlock)("core/group",{className:"evt-event-image-wrap"},[(0,t.createBlock)("core/image",{url:m||"",alt:u||"",className:"evt-event-image-block"})]);(0,c.dispatch)("core/block-editor").insertBlocks(e,0,d),s({mediaBlock:!0,hasImage:!0}),setTimeout(()=>{const e=(0,c.select)("core/block-editor").getBlock(d)?.innerBlocks[0];e&&e.innerBlocks&&e.innerBlocks[0]&&(0,c.dispatch)("core/block-editor").selectBlock(e.innerBlocks[0].clientId)},50)}}else-1!==n?((0,c.dispatch)("core/block-editor").removeBlock(a[n].clientId,!0),s({mediaBlock:!1,eventImage:"",eventImageAlt:"",hasImage:!1})):-1!==r&&((0,c.dispatch)("core/block-editor").removeBlock(a[r].clientId,!0),s({mediaBlock:!1,eventImage:"",eventImageAlt:"",hasImage:!1}))},w=(0,a.useBlockProps)({className:"evt-event-item"+(v?` evt-block-${v}`:"")}),I=[{title:"Crazy DJ Experience Santa Cruz",time:"9:00 AM - 5:00 PM",location:"JW Marriott, Sector 35",price:"$25.00"},{title:"Cute Girls Rock Band Performance",time:"9:00 AM - 5:00 PM",location:"Club XYZ, Sector 17",price:"$20.00"},{title:"Free Food Distribution At Mumbai",time:"9:00 AM - 5:00 PM",location:"Food Corp. Mumbai, Ft. Line",price:"No Cost"}],N=y?u.includes("DJ")?I[0]:u.includes("Rock")?I[1]:u.includes("Food")?I[2]:null:null,C=`${i(p)} – ${i(k)}`,D=y&&N?[["core/group",{className:"evt-event-image-wrap"},[["core/image",{url:m,alt:u,className:"evt-event-image-block"}]]],["core/group",{className:"evt-card-details"},[["evt/event-date-badge",{eventDate:g,isDateSet:!0,hideYear:!0}],["core/group",{className:"evt-event-detail"},[["core/paragraph",{className:"evt-event-time",content:C}],["core/heading",{level:4,className:"evt-event-title",content:N?.title||""}],["core/paragraph",{placeholder:(0,r.__)("Event Description","events"),className:"evt-event-description"}],["core/paragraph",{className:"evt-event-location",content:N?.location||""}],["core/group",{className:"evt-price-read-more"},[["core/paragraph",{className:"evt-event-price",content:N?.price||""}],["core/buttons",{},[["core/button",{text:"Read More",className:"evt-event-read-more",url:""}]]]]]]]]]]:[["core/group",{className:"evt-event-image-wrap"},[["core/image",{className:"evt-event-image-block"}]]],["core/group",{className:"evt-card-details"},[["evt/event-date-badge",{eventDate:g,isDateSet:!1}],["core/group",{className:"evt-event-detail"},[["core/paragraph",{placeholder:(0,r.__)("9:00 AM – 5:00 PM","events"),className:"evt-event-time",content:C}],["core/heading",{level:4,placeholder:(0,r.__)("Event Title","events"),className:"evt-event-title"}],["core/paragraph",{placeholder:(0,r.__)("Event Description","events"),className:"evt-event-description"}],["core/paragraph",{placeholder:(0,r.__)("Event Location","events"),className:"evt-event-location"}],["core/group",{className:"evt-price-read-more"},[["core/paragraph",{placeholder:(0,r.__)("Event Price","events"),className:"evt-event-price"}],["core/buttons",{},[["core/button",{text:(0,r.__)("Read More","events"),className:"evt-event-read-more",backgroundColor:"vivid-cyan-blue",url:""}]]]]]]]]]];return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.InspectorControls,null,(0,e.createElement)(n.PanelBody,{title:(0,r.__)("Event Settings","events")},(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("div",{style:{width:"100%",marginTop:"16px"}},(0,e.createElement)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"}},(0,r.__)("Details Background Color","events")),(0,e.createElement)(a.ColorPalette,{value:b,onChange:e=>s({detailsBackgroundColor:e||"#ffffff"})}))))),(0,e.createElement)("div",{...w},(0,e.createElement)("div",{className:"evt-event-card"},!f&&(0,e.createElement)("div",{className:"evt-add-image-block"},(0,e.createElement)(n.Button,{isSmall:!0,isSecondary:!0,onClick:()=>h(!0)},(0,r.__)("Add Image Block","events"))),f&&(0,e.createElement)("div",{className:"evt-add-image-block"},(0,e.createElement)(n.Button,{isSmall:!0,isSecondary:!0,onClick:()=>h(!1)},(0,r.__)("Remove Image Block","events"))),(0,e.createElement)("div",{className:"evt-event-details"},(0,e.createElement)("div",{className:"evt-event-details-inner"},(0,e.createElement)(a.InnerBlocks,{template:D,templateLock:!1,allowedBlocks:["core/group","core/image","evt/event-date-badge","core/heading","core/paragraph","core/list","core/buttons","core/button"]}))))))},save:({attributes:t})=>{const{evtBlockId:n}=t,r=a.useBlockProps.save({className:"evt-event-item"+(n?` evt-block-${n}`:"")});return(0,e.createElement)("div",{...r},(0,e.createElement)("div",{className:"evt-event-card"},(0,e.createElement)("div",{className:"evt-event-details"},(0,e.createElement)("div",{className:"evt-event-details-inner"},(0,e.createElement)(a.InnerBlocks.Content,null)))))}})})();